<div class="buses-container">
  <h2>Seleccionar L칤nea</h2>

  <div class="linea-selector">
    <p-select
      [options]="lineas"
      [(ngModel)]="lineaSeleccionada"
      (onChange)="onLineaChange($event.value)"
      optionLabel="nombreLinea"
      optionValue="codLinea"
      placeholder="-- Selecciona una l칤nea --"
      [filter]="true"
      filterBy="nombreLinea"
      styleClass="linea-select"
    >
      <ng-template let-linea pTemplate="item">
        <div>
          游뚨 {{ linea.nombreLinea }}
        </div>
      </ng-template>
    </p-select>
    <button
      *ngIf="lineaSeleccionada"
      class="btn-clear"
      (click)="resetearSeleccion()"
      title="Limpiar selecci칩n"
    >
      X
    </button>
  </div>

  <div *ngIf="ultimaHoraActualizado" class="actualizacion-info">
    칔ltima actualizaci칩n de buses: <strong>{{ ultimaHoraActualizado | date: 'HH:mm:ss' }}</strong>
  </div>


  <div class="map-panel-split" [class.panel-visible]="paradaSeleccionadaData">
    
    <div id="map" class="map-grid-item"></div>
<div class="panel-grid-item" [hidden]="!paradaSeleccionadaData">
  
  <p-panel *ngIf="paradaSeleccionadaData" [style]="{'width': '100%'}">
    <ng-template pTemplate="header">
      <div class="panel-header">
        <span class="p-panel-title">Detalle de Parada</span>
        <button
          pButton
          type="button"
          icon="pi pi-times"
          class="p-button-secondary p-text"
          (click)="cerrarPanel()">
        </button>
      </div>
    </ng-template>
    <ng-template pTemplate="content">
      <h3>{{ paradaSeleccionadaData.nombreParada }}</h3>
      <p><strong>Direcci칩n:</strong> {{ paradaSeleccionadaData.direccion || 'No disponible' }}</p>
      <hr>
      <h4>L칤neas que pasan por aqu칤:</h4>
      
      <div *ngIf="lineasDeParada === null">
        <p>Cargando l칤neas...</p>
      </div>
      
      <div *ngIf="lineasDeParada !== null">
        <div *ngIf="lineasDeParada.length === 0">
          <p>No se encontraron l칤neas para esta parada.</p>
        </div>
        <ul class="lineas-list" *ngIf="lineasDeParada.length > 0">
          <li *ngFor="let linea of lineasDeParada">
            <span class="linea-codigo">({{ linea.codLinea }})</span>
            {{ linea.nombreLinea }}
          </li>
        </ul>
      </div>
    </ng-template>
  </p-panel>
</div>

  </div>
  <div class="stats-container" style="margin-top: 2rem;">
    <div class="filtro-grafico" style="margin-bottom: 1rem;">
      <label for="fechaStats" style="margin-right: 10px;">Seleccionar Fecha:</label>
      <p-select
        id="fechaStats"
        [options]="fechasDisponibles"
        [(ngModel)]="fechaSeleccionada"
        (onChange)="onFechaChange($event.value)"
        optionLabel="fecha_dia"
        optionValue="fecha_dia"
        placeholder="-- Selecciona fecha --"
      ></p-select>
    </div>

    <h4>Estad칤sticas de la Flota</h4>
    <app-chart
      *ngIf="datosHorasPunta"
      [chartData]="datosHorasPunta!"
      [chartOptions]="opcionesHorasPunta"
      chartType="bar"
      chartId="horasPuntaChart"
    ></app-chart>
    
    <div *ngIf="!datosHorasPunta">
      <p>Cargando datos del gr치fico...</p>
    </div>
  </div>

</div>