<div class="d-flex justify-content-end mb-3 gap-2">
  <button class="p-button p-button-success p-button-sm" (click)="expandAll()">Expandir todo</button>
  <button class="p-button p-button-warning p-button-sm" (click)="collapseAll()">Colapsar todo</button>
</div>

<p-table [value]="tablas" [tableStyle]="{ 'min-width': '40rem' }" class="tabla-personalizada">

  <!-- Cabecera principal -->
  <ng-template pTemplate="header">
    <tr class="encabezado-tabla">
      <th>Nombre</th>
      <th style="width: 5rem">Detalles</th>
      <th style="width: 5rem">Eliminar</th>
    </tr>
  </ng-template>

  <!-- Cuerpo principal -->
  <ng-template pTemplate="body" let-client>
    <tr class="fila-tabla">
      <td>{{ client.nombre }}</td>
      <td>
        <button class="p-button p-button-secondary p-button-sm"
                (click)="client.expanded = !client.expanded">
          {{ client.expanded ? '-' : '+' }}
        </button>
      </td>
      <td>
        <button class="p-button p-button-danger p-button-sm"
                (click)="onDeleteClient(client.id)">
          <i class="pi pi-trash"></i>
        </button>
      </td>
    </tr>

    <!-- Fila expandida -->
    <tr *ngIf="client.expanded">
      <td colspan="3">
        <div class="detalle-expandido">
          <div class="d-flex flex-column gap-2">
            <div><strong>ID:</strong> {{ client.id }}</div>
            <div><strong>DNI:</strong> {{ client.dni }}</div>
            <div><strong>Dirección:</strong> {{ client.direccion || 'N/A' }}</div>
            <div>
              <strong>Teléfonos:</strong>
              <ul *ngIf="client.telefonos?.length > 0; else noTel">
                <li *ngFor="let t of client.telefonos">{{ t.numero }} ({{ t.type }})</li>
              </ul>
              <ng-template #noTel>No hay teléfonos</ng-template>
            </div>

            <!-- Botón para editar -->
            <button class="p-button p-button-info p-button-sm align-self-start mt-2"
                    (click)="abrirEditar(client)">
              <i class="pi pi-pencil"></i> Editar
            </button>
          </div>
        </div>
      </td>
    </tr>
  </ng-template>

  <!-- Mensaje vacío -->
  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="3">No hay clientes para mostrar.</td>
    </tr>
  </ng-template>

</p-table>

<!-- Modal de edición -->
<p-dialog header="Editar Cliente" [(visible)]="displayEditDialog" [modal]="true" [style]="{width: '30vw'}">
  <div class="p-fluid">
    <div class="field">
      <label for="nombre">Nombre</label>
      <input id="nombre" type="text" pInputText [(ngModel)]="clienteSeleccionado.nombre" />
    </div>

    <div class="field">
      <label for="dni">DNI</label>
      <input id="dni" type="text" pInputText [(ngModel)]="clienteSeleccionado.dni" />
    </div>

    <div class="field">
      <label for="direccion">Dirección</label>
      <input id="direccion" type="text" pInputText [(ngModel)]="clienteSeleccionado.direccion" />
    </div>
  </div>

  <ng-template pTemplate="footer">
    <button class="p-button p-button-secondary" (click)="displayEditDialog=false">Cancelar</button>
    <button class="p-button p-button-success" (click)="guardarCambios()">Guardar</button>
  </ng-template>
</p-dialog>
