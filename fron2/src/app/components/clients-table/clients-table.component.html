<div class="d-flex justify-content-end mb-3 gap-2">
  <button class="p-button p-button-success p-button-sm" (click)="expandAll()">Expandir todo</button>
  <button class="p-button p-button-warning p-button-sm" (click)="collapseAll()">Colapsar todo</button>
</div>

<p-table [value]="tablas" [tableStyle]="{ 'min-width': '40rem' }" class="tabla-personalizada">

  <!-- Cabecera principal -->
  <ng-template pTemplate="header">
    <tr class="encabezado-tabla">
      <th>Nombre</th>
      <th style="width: 5rem">Detalles</th>
      <th style="width: 5rem">Eliminar</th>
    </tr>
  </ng-template>

  <!-- Cuerpo principal -->
  <ng-template pTemplate="body" let-client>
    <tr class="fila-tabla">
      <td>{{ client.nombre }}</td>
      <td>
        <button class="p-button p-button-secondary p-button-sm"
                (click)="client.expanded = !client.expanded">
          {{ client.expanded ? '-' : '+' }}
        </button>
      </td>
      <td>
        <button class="p-button p-button-danger p-button-sm"
                (click)="onDeleteClient(client.id)">
          <i class="pi pi-trash"></i>
        </button>
      </td>
    </tr>

    <!-- Fila expandida -->
    <tr *ngIf="client.expanded">
      <td colspan="3">
        <div class="detalle-expandido">
          <div class="d-flex flex-column gap-2">

            <!-- Datos expandido -->
            <div *ngIf="!client.editando">
              <div><strong>ID:</strong> {{ client.id }}</div>
              <div><strong>DNI:</strong> {{ client.dni }}</div>
              <div><strong>Dirección:</strong> {{ client.direccion || 'N/A' }}</div>
              <div>
                <strong>Teléfonos:</strong>
                <ul *ngIf="client.telefonos?.length > 0; else noTel">
                  <li *ngFor="let t of client.telefonos">{{ t.numero }} ({{ t.type }})</li>
                </ul>
                <ng-template #noTel>No hay teléfonos</ng-template>
              </div>
              <button pButton class="p-button-info p-button-sm mt-2" (click)="editarCliente(client)">
                 <i class="pi pi-pencil"></i> <!-- Editar -->
              </button>
            </div>

            <!-- Editando cliente-->
            <div *ngIf="client.editando">
              <div>
                <label>Nombre</label>
                <input pInputText [(ngModel)]="client.nombre"> <!--[(ngModel)] enlaza ,cambios input<->variable -->

              </div>
              <div>
                <label>DNI</label>
                <input pInputText [(ngModel)]="client.dni">
              </div>
              <div>
                <label>Dirección</label>
                <input pInputText [(ngModel)]="client.direccion">
              </div>
              <div>
                <label>Teléfonos</label>
                <div *ngFor="let t of client.telefonos; let i = index" class="d-flex gap-2 mb-2">
                  <input type="text" [(ngModel)]="t.numero" placeholder="Número" pInputText>
                  <select [(ngModel)]="t.type">
                    <option value="mobile">Mobile</option>
                    <option value="landline">Landline</option>
                    <option value="office">Office</option>
                  </select>
                  <button type="button" pButton icon="pi pi-trash" class="p-button-danger p-button-sm"
                          (click)="client.telefonos.splice(i, 1)"></button> `<!-- Elimina 1 teléfono del array en la posición i`-->

                </div>
                <button type="button" pButton class="p-button-success p-button-sm mt-2"
                        (click)="client.telefonos.push({numero:'', type:'mobile'})">
                  <i class="pi pi-plus"></i> Añadir Teléfono
                </button>
              </div>
              <button type="button" pButton class="p-button-success mt-2"
                      (click)="guardarCambios(client)">
                Guardar cambios
              </button>

            </div>

          </div>
        </div>
      </td>
    </tr>
  </ng-template>

  <!-- Mensaje vacío -->
  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="3">No hay clientes para mostrar.</td>
    </tr>
  </ng-template>

</p-table>
