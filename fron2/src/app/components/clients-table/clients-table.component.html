<div class="d-flex justify-content-end mb-3 gap-2">
  <button class="p-button p-button-success p-button-sm" (click)="expandAll()">Expandir todo</button>
  <button class="p-button p-button-warning p-button-sm" (click)="collapseAll()">Colapsar todo</button>
</div>

<p-table [value]="tablas" [tableStyle]="{ 'min-width': '40rem' }" class="tabla-personalizada">
  <ng-template pTemplate="header">
    <tr class="encabezado-tabla">
      <th>Nombre</th>
      <th style="width: 5rem">Detalles</th>
      <th style="width: 5rem">Eliminar</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-client>
    <tr class="fila-tabla">
      <td>{{ client.nombre }}</td>
      <td>
        <button class="p-button p-button-secondary p-button-sm" (click)="client.expanded = !client.expanded">
          {{ client.expanded ? '-' : '+' }}
        </button>
      </td>
      <td>
        <button class="p-button p-button-danger p-button-sm" (click)="onDeleteClient(client.id)">
          <i class="pi pi-trash"></i>
        </button>
      </td>
    </tr>

    <tr *ngIf="client.expanded">
      <td colspan="3">
        <div class="detalle-expandido">
          <div class="d-flex flex-column gap-2">

            <div>
              <div><strong>DNI:</strong> {{ client.dni }}</div>
              <div><strong>Dirección:</strong> {{ client.direccion || 'N/A' }}</div>
              <div>
                <strong>Teléfonos:</strong>
                <ul *ngIf="client.telefonos?.length > 0; else noTel">
                  <li *ngFor="let t of client.telefonos">
                    {{ t.numero }} ({{ t.type }})
                    <button pButton class="p-button-info p-button-sm mt-2" (click)="abrirModalConsumo(client, t)">
                      <i class="pi pi-chart-bar"></i> Consumos
                    </button>
                  </li>
                </ul>
                <ng-template #noTel>No hay teléfonos</ng-template>
              </div>

              <button pButton class="p-button-info p-button-sm mt-2" (click)="abrirModal(client)">
                <i class="pi pi-pencil"></i> Editar
              </button>
            </div>

          </div>
        </div>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="3">No hay clientes para mostrar.</td>
    </tr>
  </ng-template>
</p-table>

<p-dialog header="Editar Cliente" [(visible)]="displayEditDialog" [modal]="true" [style]="{width: '500px'}">
  <app-edit-client [cliente]="clienteSeleccionado" (clienteActualizado)="actualizarCliente($event)"></app-edit-client>
</p-dialog>

<p-dialog header="Ver consumos" [(visible)]="displayConsumoDialog" [modal]="true" [style]="{width: '9000px', height: '900px'}">
  <app-consumo-table 
      [cliente]="clienteSeleccionado"
      [telefonoSeleccionado]="telefonoSeleccionado">
  </app-consumo-table>
</p-dialog>
